# Event Framework

The purpose of the Event Framework is to provide a standard unified architecture to capture all Mojaloop events.


## 1. Requirements

- Events will be produced by utilising a standard common library that will publish events to a sidecar component utilising a light-weight highly performant protocol (e.g. gRPC).
- Sidecar module will publish events to a singular Kafka topic that will allow for multiple handlers to consume and process the events as required.
- Kafka partitions will be determined by the event-type (e.g. log, audit, trace, errors etc).
- Each Mojaloop component will have its own tightly coupled Sidecar.


## 2. Architecture overview

![Event Framework Architecture](./assets/diagrams/architecture/architecture-event-framework.svg)


## 3. Pod Architecture

![Pod Architecture](./assets/diagrams/architecture/architecture-event-sidecar.svg) 


### 4. Event Envelope Model

### 4.1 Object Definition: MessageType 

| Name | Type | Description | Example |
| --- | --- | --- | --- |
| id | string | Mandatory. The id references the related message. |  |
| from | string | Optional. If the value is not present in the destination, it means that the notification was generated by the connected node (server). |  |
| to | string | Mandatory for the sender and optional in the destination. The sender can ommit the value of the domain. | |
| pp | string | Optional for the sender, when is considered the identity of the session. Is mandatory in the destination if the identity of the originator is different of the identity of the from property. | |
| metadata | object \<metadataType\> | Optional. The sender should avoid to use this property to transport any kind of content-related information, but merely data relevant to the context of the communication. Consider to define a new content type if there's a need to include more content information into the message. | |
| type | string | `MIME` declaration of the content type of the message. | |
| content | object \<any\> | The representation of the content. | |


#### 4.1.1 Object Definition: MetadataType 

| Name | Type | Description | Example |
| --- | --- | --- | --- |
| event | object \<eventType\> | Mandatory. Event information. |  |

#### 4.1.2 Object Definition: EventType 

| Name | Type | Description | Example |
| --- | --- | --- | --- |
| id | string | Mandatory. The id references the related message. |  |
| type | string | Mandatory. The id references the related message. |  |
| action | string | Mandatory. The id references the related message. |  |
| state | object \<stateType\> | Mandatory. The id references the related message. |  |\| createdAt | string | Mandatory. The id references the related message. |  |

#### 4.1.3 Object Definition: StateType 

| Name | Type | Description | Example |
| --- | --- | --- | --- |
| status | string | Mandatory. The id references the related message. |  |
| code | string | Mandatory. The id references the related message. |  |
| description | string | Optional. The id references the related message. |  |


#### 4.1.4 Enum: eventType

| Type | Description | Actions |
| --- | --- | --- |
| log | Event representing a general log entry. | [ `info`, `debug`, `verbose`, `perf` ] |
| audit | Event to be signed and persisted into the audit store. | [ --- ] |
| trace | Event containing trace context information to be persisted into the tracing store. | [ `start`, `end` ] |
| error | Event representing an error. | [ `internal`, `external` ] |


## 4. Impact to the Mojaloop Message Stream

The Mojaloop message stream 

